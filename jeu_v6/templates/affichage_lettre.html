<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affichage des Lettres</title>
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        #liste_affichage {
            text-align: center;
        }
        .mot {
            margin: 10px;
        }
        .hidden {
            display: none;
        }
        img {
            width: 300px;
            height: 300px;
        }
        #lives {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="feedbackMessage" class="hidden"></div>
    <div id="liste_affichage">
        {% for element in liste_affichage %}
        <div class="mot {% if loop.index0 != currentIndex %}hidden{% endif %}">
            <img src="{{ url_for('static', filename=lsf_lettres[element]) }}" alt="{{ element }}">
        </div>
        {% endfor %}
    </div>
    <div id="lives">
        Lives: {{ vies }}
    </div>
    <form id="Affichage" action="{{ url_for('affichage', difficulte=difficulte, game_mode=game_mode) }}" method="post">
        <input type="hidden" id="current_index" name="currentIndex" value="{{ currentIndex }}">
        <input type="radio" id="response_non" name="response" value="non">
        <label for="response_non">Non</label>
        <input type="radio" id="response_oui" name="response" value="oui" checked>
        <label for="response_oui">Oui</label>
        <button type="submit">Submit</button>
    </form>
    <form id="formFinDePartie" action="{{ url_for('fin_de_partie') }}" method="get" class="hidden">
        <button type="submit">Fin de partie</button>
    </form>
    <div id="pythonData" data-liste-reponses="{{ liste_reponses_json | safe }}" style="display: none;"></div>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
    let currentIndex = parseInt('{{ currentIndex }}', 10);
    let vies = parseInt('{{ vies }}', 10);
    const listeAffichage = JSON.parse('{{ liste_affichage_json | safe }}');
    const listeReponses = JSON.parse('{{ liste_reponses_json | safe }}');
    const form = document.getElementById('Affichage');

    form.addEventListener('submit', function(event) {
        event.preventDefault();

        const userInput = document.querySelector('input[name="response"]:checked').value === 'oui';
        const isLastLetter = currentIndex === listeAffichage.length - 1;

        if (isLastLetter && userInput) {
            // If it's the last letter and user says "Yes", end the game
            document.getElementById('formFinDePartie').submit();
            return;
        }

        if (listeReponses[currentIndex] !== userInput) {
            vies -= 1; // Decrease lives if wrong answer
            document.getElementById('lives').innerText = `Lives: ${vies}`;
        }

        if (!isLastLetter) {
            currentIndex += 1; // Only move to next letter if it's not the last one
        }

        if (vies <= 0) {
            // If out of lives, end the game regardless
            document.getElementById('formFinDePartie').submit();
            return;
        }

        updateDisplay(currentIndex); // Update the display based on the current index
    });

    function updateDisplay(currentIndex) {
        document.getElementById('current_index').value = currentIndex;

        // Hide all .mot elements
        document.querySelectorAll('.mot').forEach(element => {
            element.classList.add('hidden');
        });

        // Show the next .mot element based on currentIndex
        const nextMotElement = document.querySelector(`.mot:nth-child(${currentIndex + 1})`);
        if (nextMotElement) {
            nextMotElement.classList.remove('hidden');
        }
    }
});



        </script>
        
</body>
</html>